{{ template "header.html" . }}
        <div class="tabs">
            <a href="/admin/posts" class="active">文章</a>
            <a href="/admin/pages">独立页面</a>
            <a href="/admin/categories">分类</a>
            <a href="/admin/comments">评论</a>
            <a href="/admin/settings">系统设置</a>
        </div>

        <h2 class="panel-title">管理文章</h2>
        
        <!-- 搜索和筛选 -->
        <div class="filter-bar">
            <input type="text" id="search-input" placeholder="搜索文章标题..." class="filter-input">
            <select id="category-filter" class="filter-select">
                <option value="">所有分类</option>
                {{range .Categories}}
                <option value="{{.Name}}">{{.Name}}</option>
                {{end}}
            </select>
            <div class="batch-actions" id="batch-actions" style="display: none;">
                <span class="batch-count">已选 <strong id="selected-count">0</strong> 篇</span>
                <button class="btn btn-danger btn-sm" onclick="batchDelete()">批量删除</button>
            </div>
        </div>
        
        <div class="card">
            <table>
                <thead>
                    <tr>
                        <th width="30"><input type="checkbox" id="select-all" onclick="toggleSelectAll()"></th>
                        <th width="35%">标题</th>
                        <th>作者</th>
                        <th>分类</th>
                        <th>日期</th>
                        <th style="text-align: right;">操作</th>
                    </tr>
                </thead>
                <tbody id="posts-body">
                    {{range .Posts}}
                    <tr data-title="{{.Title}}" data-category="{{.Category}}" data-path="{{.FilePath}}">
                        <td><input type="checkbox" class="post-checkbox" onchange="updateBatchActions()"></td>
                        <td>
                            <a href="/admin/edit?path={{.FilePath}}" style="color: #444; text-decoration: none; font-weight: bold;">{{.Title}}</a>
                            {{if .Draft}}<span class="badge badge-draft">草稿</span>{{end}}
                            <a href="/{{.Category}}/{{.Slug}}.html" target="_blank" style="color: #999; margin-left: 5px;"><i class="fa-solid fa-external-link-alt" style="font-size: 10px;"></i></a>
                        </td>
                        <td>admin</td>
                        <td><a href="/category/{{.Category}}" target="_blank" style="color: #467b96;">{{.Category}}</a></td>
                        <td>{{.Date.Format "2006-01-02"}}</td>
                        <td style="text-align: right;">
                            <a href="/admin/edit?path={{.FilePath}}" class="btn btn-outline btn-xs">编辑</a>
                            <button 
                                hx-post="/admin/delete" 
                                hx-vals='{"path": "{{.FilePath}}"}'
                                hx-confirm="你确认要删除这篇文章吗？"
                                hx-target="closest tr"
                                hx-swap="outerHTML"
                                class="btn btn-danger btn-xs">删除</button>
                        </td>
                    </tr>
                    {{end}}
                    {{if not .Posts}}
                    <tr>
                        <td colspan="6" class="empty">暂无文章</td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
        </div>
        
        <script>
        // 文章搜索和筛选
        const searchInput = document.getElementById('search-input');
        const categoryFilter = document.getElementById('category-filter');
        const rows = document.querySelectorAll('#posts-body tr[data-title]');
        
        function filterPosts() {
            const searchTerm = searchInput.value.toLowerCase();
            const category = categoryFilter.value;
            
            rows.forEach(row => {
                const title = row.dataset.title.toLowerCase();
                const rowCategory = row.dataset.category;
                const matchSearch = title.includes(searchTerm);
                const matchCategory = !category || rowCategory === category;
                row.style.display = matchSearch && matchCategory ? '' : 'none';
            });
        }
        
        searchInput.addEventListener('input', filterPosts);
        categoryFilter.addEventListener('change', filterPosts);
        
        // 批量操作
        function toggleSelectAll() {
            const selectAll = document.getElementById('select-all');
            document.querySelectorAll('.post-checkbox').forEach(cb => {
                cb.checked = selectAll.checked;
            });
            updateBatchActions();
        }
        
        function updateBatchActions() {
            const checked = document.querySelectorAll('.post-checkbox:checked');
            const batchActions = document.getElementById('batch-actions');
            const selectedCount = document.getElementById('selected-count');
            
            if (checked.length > 0) {
                batchActions.style.display = 'flex';
                selectedCount.textContent = checked.length;
            } else {
                batchActions.style.display = 'none';
            }
        }
        
        function batchDelete() {
            const checked = document.querySelectorAll('.post-checkbox:checked');
            if (checked.length === 0) return;
            
            if (!confirm(`确定要删除选中的 ${checked.length} 篇文章吗？此操作不可恢复！`)) return;
            
            const paths = [];
            checked.forEach(cb => {
                const row = cb.closest('tr');
                paths.push(row.dataset.path);
            });
            
            fetch('/admin/batch-delete', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({paths: paths})
            })
            .then(res => res.json())
            .then(data => {
                if (data.status === 'ok') {
                    location.reload();
                } else {
                    alert('删除失败: ' + data.error);
                }
            });
        }
        </script>
{{ template "footer.html" . }}
