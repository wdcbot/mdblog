{% extends "base.html" %}

{% block title %}æœç´¢: {{ Query }} - {{ Site.Title }}{% endblock %}

{% block content %}
<div class="search-page">
    <div class="search-header">
        <h1 class="search-title">
            <i class="fa-solid fa-magnifying-glass"></i>
            æœç´¢ç»“æœ
        </h1>
        <p class="search-info">å…³é”®è¯ "<mark>{{ Query }}</mark>" å…±æ‰¾åˆ° <strong>{{ Posts|length }}</strong> ç¯‡æ–‡ç« </p>
    </div>

    <div class="search-results">
        {% for post in Posts %}
        <article class="search-item">
            <div class="search-item-meta">
                <span class="category">{{ post.Category }}</span>
                <span class="dot"></span>
                <span>{{ post.Date|date:"2006-01-02" }}</span>
            </div>
            <h2 class="search-item-title">
                <a href="/{{ post.Category }}/{{ post.Slug }}.html" data-title="{{ post.Title }}">{{ post.Title }}</a>
            </h2>
            <p class="search-item-summary" data-summary="{{ post.Summary }}">{{ post.Summary }}</p>
        </article>
        {% empty %}
        <div class="search-empty">
            <div class="search-empty-icon">ğŸ”</div>
            <h3>æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å†…å®¹</h3>
            <p>è¯•è¯•å…¶ä»–å…³é”®è¯ï¼Œæˆ–è€…æµè§ˆ <a href="/categories">æ‰€æœ‰åˆ†ç±»</a></p>
        </div>
        {% endfor %}
    </div>
</div>

<script>
// é«˜äº®æœç´¢å…³é”®è¯
const query = "{{ Query }}".toLowerCase();
if (query) {
    document.querySelectorAll('.search-item-title a, .search-item-summary').forEach(el => {
        const text = el.textContent;
        const regex = new RegExp(`(${query})`, 'gi');
        if (regex.test(text)) {
            el.innerHTML = text.replace(regex, '<mark>$1</mark>');
        }
    });
}
</script>
{% endblock %}
