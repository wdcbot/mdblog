{% extends "base.html" %}

{% block title %}{{ Post.Title }} - {{ Site.Title }}{% endblock %}
{% block description %}{{ Post.Summary }}{% endblock %}
{% block og_title %}{{ Post.Title }}{% endblock %}
{% block og_description %}{{ Post.Summary }}{% endblock %}
{% block og_type %}article{% endblock %}
{% block og_url %}/{{ Post.Category }}/{{ Post.Slug }}.html{% endblock %}

{% block content %}
<div class="article-wrapper">
    <article class="article {% if Post.TOC and Site.TOCEnabled %}has-toc{% endif %}">
        <header class="post-header">
            <div class="post-meta">
                {{ Post.Date|date:"2006å¹´01æœˆ02æ—¥" }} Â· {{ Post.Category }} Â· {{ Post.WordCount }} å­—
                {% if Site.ReadingTimeEnabled %} Â· çº¦ {{ Post.ReadingTime }} åˆ†é’Ÿ{% endif %}
            </div>
            <h1>{{ Post.Title }}</h1>
            <div class="tags">
                {% for tag in Post.Tags %}
                <a href="/tag/{{ tag|urlencode }}" class="tag">#{{ tag }}</a>
                {% endfor %}
            </div>
        </header>

        <div class="content">
            {{ Content|safe }}
        </div>
        
        <!-- æ–‡ç« åº•éƒ¨å¹¿å‘Šä½ -->
        {% if Site.AdsCode %}
        <div class="ad-container" style="margin: 2rem 0; text-align: center;">
            <ins class="adsbygoogle"
                style="display:block"
                data-ad-format="auto"
                data-full-width-responsive="true"></ins>
        </div>
        {% endif %}

        <nav class="post-nav">
            {% if PrevPost %}
            <a href="/{{ PrevPost.Category }}/{{ PrevPost.Slug }}.html" class="post-nav-link prev">
                <span class="post-nav-label">â† ä¸Šä¸€ç¯‡</span>
                <span class="post-nav-title">{{ PrevPost.Title }}</span>
            </a>
            {% else %}
            <span class="post-nav-link disabled"></span>
            {% endif %}
            
            {% if NextPost %}
            <a href="/{{ NextPost.Category }}/{{ NextPost.Slug }}.html" class="post-nav-link next">
                <span class="post-nav-label">ä¸‹ä¸€ç¯‡ â†’</span>
                <span class="post-nav-title">{{ NextPost.Title }}</span>
            </a>
            {% endif %}
        </nav>
        
        {% if RelatedPosts %}
        <section class="related-posts">
            <h3 class="related-title">ç›¸å…³æ–‡ç« </h3>
            <div class="related-list">
                {% for post in RelatedPosts %}
                <a href="/{{ post.Category }}/{{ post.Slug }}.html" class="related-item">
                    <span class="related-item-title">{{ post.Title }}</span>
                    <span class="related-item-meta">{{ post.Date|date:"2006-01-02" }}</span>
                </a>
                {% endfor %}
            </div>
        </section>
        {% endif %}
        
        <!-- è¯„è®ºåŒº -->
        {% if Site.CommentsEnabled %}
        <section class="comments-section">
            <h3 class="comments-title">ğŸ’¬ è¯„è®º</h3>
            
            <div class="comments-list" id="comments-list">
                {% for comment in Comments %}
                <div class="comment-item" data-id="{{ comment.ID }}">
                    <div class="comment-header">
                        <span class="comment-author">{{ comment.Author }}</span>
                        <span class="comment-date">{{ comment.CreatedAt|date:"2006-01-02 15:04" }}</span>
                    </div>
                    <div class="comment-content">{{ comment.Content }}</div>
                    <button class="comment-reply-btn" onclick="showReplyForm('{{ comment.ID }}', '{{ comment.Author }}')">å›å¤</button>
                    
                    {% if comment.Replies %}
                    <div class="comment-replies">
                        {% for reply in comment.Replies %}
                        <div class="comment-item reply" data-id="{{ reply.ID }}">
                            <div class="comment-header">
                                <span class="comment-author">{{ reply.Author }}</span>
                                {% if reply.ReplyTo %}<span class="reply-to">å›å¤ @{{ reply.ReplyTo }}</span>{% endif %}
                                <span class="comment-date">{{ reply.CreatedAt|date:"2006-01-02 15:04" }}</span>
                            </div>
                            <div class="comment-content">{{ reply.Content }}</div>
                            <button class="comment-reply-btn" onclick="showReplyForm('{{ comment.ID }}', '{{ reply.Author }}')">å›å¤</button>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                {% empty %}
                <p class="no-comments">æš‚æ— è¯„è®ºï¼Œæ¥è¯´ä¸¤å¥å§ ~</p>
                {% endfor %}
            </div>
            
            <form class="comment-form" id="comment-form">
                <h4 id="form-title">âœï¸ å‘è¡¨è¯„è®º</h4>
                <input type="hidden" name="post_slug" value="{{ Post.Slug }}">
                <input type="hidden" name="parent_id" id="parent_id" value="">
                <input type="hidden" name="reply_to" id="reply_to" value="">
                <div class="form-row">
                    <input type="text" name="author" id="comment-author" placeholder="æ˜µç§° *" required>
                    <input type="email" name="email" id="comment-email" placeholder="é‚®ç®±ï¼ˆé€‰å¡«ï¼Œä¸ä¼šå…¬å¼€ï¼‰">
                </div>
                <textarea name="content" id="comment-content" placeholder="å†™ä¸‹ä½ çš„æƒ³æ³•..." rows="4" required></textarea>
                <div class="comment-form-footer">
                    <button type="submit" class="btn-primary">æäº¤è¯„è®º</button>
                    <button type="button" class="btn-cancel" id="cancel-reply" style="display:none" onclick="cancelReply()">å–æ¶ˆå›å¤</button>
                </div>
            </form>
        </section>
        {% endif %}
    </article>
    
    {% if Post.TOC and Site.TOCEnabled %}
    <aside class="toc-sidebar">
        <div class="toc-container">
            <h4 class="toc-title">ç›®å½•</h4>
            <nav class="toc-nav">
                {% for item in Post.TOC %}
                <a href="#{{ item.ID }}" class="toc-link toc-level-{{ item.Level }}">{{ item.Title }}</a>
                {% endfor %}
            </nav>
        </div>
    </aside>
    {% endif %}
</div>
{% endblock %}
